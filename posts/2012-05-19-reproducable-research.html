<!doctype html>
<html lang="en">
  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-45010384-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-45010384-1');
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Tom Torsney-Weir</title>
    <link rel="stylesheet" href="../css/normalize.css" />
    <script src="https://kit.fontawesome.com/bfc83b0cb2.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="../css/default.css" />
  </head>
  <body>
    <header class="site-header">
      <div class="logo">
        <a href="../"><h1>Tom Torsney-Weir</h1></a>
      </div>
      <nav class="site-nav">
        <a href="../about.html">About</a>
        <a href="../publications.html">Publications</a>
        <a href="../teaching.html">Teaching</a>
        <a href="../blog.html">Blog</a>
        <a href="../cv.html">CV</a>
      </nav>

      <!--<hr/>-->
    </header>

    <main role="main">
      <article>
  <h1 class="article-title">Reproducable research</h1>
  <section class="byline">
    <date class="post-date">May 19, 2012</date>
  </section>
  <section>
    <p>I have a terrible memory for what I’ve done in the past. I can barely remember what I had for breakfast let alone specifics about a data analysis I did from the past week. I tend to go down so many wrong paths that by the time my weekly supervisor meeting rolls around I have no idea what I’ve done or why I’ve done it. I would often stare dumbfounded when asked seemingly simple questions like, “how did you make this graph?” or even “why did you make this graph?”</p>
<p>So, for the past few months I’ve started producing weekly reports using R and multimarkdown to give to my supervisors before our meetings. It’s a summary of my work from the past week. This basically constitutes a lab notebook for me. A lot of my work involves writing a lot of math formulae, producing plots and images, some code to munge data, and text to explain what I’m doing.</p>
<!--more-->
<figure>
<img src="../images/notebook-preview.png" alt /><figcaption>preview image</figcaption>
</figure>
<p>I use R for any sort of numerical computing and multimarkdown has been my go-to markup language for some time. My favorite feature of multimarkdown is its support for processing LaTeX math. Now that the <a href="http://yihui.name/knitr/">knitr package</a> is out I can tie my analysis code (written in R) to my explanations (written in markdown). What’s also great about this system is that my analysis is contained entirely in a text file that I can store in source control along with any data and the rest of my project.</p>
<p>The rest of this post goes into detail about how I’ve set up Vim, knitr, and <a href="http://markedapp.com/">Marked.app</a> on my Mac to automatically update my report every time I save. The code is located at <a href="https://github.com/gabysbrain/r-notebook" class="uri">https://github.com/gabysbrain/r-notebook</a>.</p>
<h2 id="editor-vim">Editor: Vim</h2>
<p>The best thing about this method is that it’s pretty much editor agnostic. Marked doesn’t care what editor you use as long as it’s editing markdown. So, I get to use the only text editor I’ve ever liked: vim!</p>
<p>I linked Marked to vim with the instructions from <a href="http://captainbollocks.tumblr.com/post/9858989188/linking-macvim-and-marked-app">A Whole lot of Bollocks’ blog post</a> so that I can hit <code>&lt;leader&gt;-m</code> and have the file I’m editing open in Marked. Once the file is open it automatically updates every time I save.</p>
<p>To make my editing more efficient I use the <a href="http://www.vim.org/scripts/script.php?script_id=2540">SnipMate plugin</a> which brings TextMate-style snippets to vim. Basically, you can type a shorter string, hit tab, and have it expand into anything you want. It’s really great for adding boilerplate code. I particularly like this for adding the knitr code blocks. With the fork of SnipMate I have set up (<a href="https://github.com/gabysbrain/snipmate.vim" class="uri">https://github.com/gabysbrain/snipmate.vim</a>) typing <code>rcode</code> expands to</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1"></a>&lt;!--<span class="co">begin.rcode ${1},cache=TRUE,dependson='${2}'</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co">${3}</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co">end.rcode--&gt;</span></span></code></pre></div>
<p>and typing <code>rfig</code> expands to</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb2-1"><a href="#cb2-1"></a>&lt;!--<span class="co">begin.rcode ${1},cache=TRUE,dependson='${2}',fig.width=${3:12},fig.height=${4:12},dev='png'</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co">${5}</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co">end.rcode--&gt;</span></span></code></pre></div>
<p>I’m also using the multimarkdown syntax highlighter: <a href="https://github.com/jngeist/vim-multimarkdown" class="uri">https://github.com/jngeist/vim-multimarkdown</a>.</p>
<h2 id="processor-knitr">Processor: knitr</h2>
<p>In its default incarnation knitr provides a lot of functionality out of the box for processing R code embedded in a markdown document. The killer feature (other than the markdown output) in my opinion is its caching and and dependency layer so I don’t have to wait for R to recompute every section when I just change one. It’s also smart enough to recompute any blocks that depend on the one I changed.</p>
<p>The main issue is that knitr is designed to be run from the desired working directory. This is how it sets the locations for the images and cache files. Luckily, when you run a custom markdown processor in recent versions of Marked it appends the directory containing whatever file you’re editing to the end of the path. So, all you have to do before running code through knitr is change the current working directory to the last item in PATH and the cache and images will be in the proper place.</p>
<p>This script also allows me to add some custom hooks into the markdown processor. I mostly use this to test out new features before submitting them to the main knitr development.</p>
<h2 id="viewer-marked">Viewer: Marked</h2>
<p>This all gets piped through Marked. Marked.app is an amazing and simple markdown preview tool. When the preview is open it watches my source file for changes and automatically updates when I save in vim.</p>
<p>By default it uses its own multimarkdown processor but you can override that with your own. It also supports a custom css file. The one I’m using is slightly modified from the github theme but with nicer tables.</p>
<h2 id="future">Future</h2>
<p>Right now I print the final document to PDF and then email the file to my supervisors. Eventually though I’m going to upload the whole thing to a private research blog that we all share.</p>
<p>I’d also like to add a lot more interactive features to the HTML. The killer features would be interactive manipulation of graphics and having those changes reflected in the source document. It would also be great if I could inspect R objects directly in the HTML document as well. This would require some interaction with a running version of R though.</p>
<p>But for now, I’m happy that I can easily make a record of what I’ve done each week and my supervisor is happy that I can show what I’ve done!</p>
  </section>
</article>

    </main>

    <footer>
      <hr />

      <p>© Copyright Tom Torsney-Weir</p>

      <p>
      Site proudly generated by
      <a href="http://jaspervdj.be/hakyll">Hakyll</a>
      </p>
    </footer>
  </body>
</html>
