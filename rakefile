
task :download_bib do
  sh('curl', '-L', '-o', 'all.bib', 'https://www.dropbox.com/s/22giq4qdaqg64yt/all.bib?dl=0')
end

# setup build environment
task :setup do
  deps
  git_config("Thomas Torsney-Weir")
end

task :cssetup do
  deps
  git_config("Codeship robot")
end

task :update_hl_css do
  syntax_dir = 'source/stylesheets/syntax'
  FileUtils.mkdir_p syntax_dir
  Rake::FileList["bower_components/highlightjs/styles/*.css"].each do |css_file|
    scss_file = "#{syntax_dir}/_#{File.basename(css_file, ".css")}.scss"
    FileUtils.copy_file(css_file, scss_file)
  end
end

task :build => [:download_bib, :update_hl_css] do
  sh('bundle', 'exec', 'middleman', 'build')
end

task :clean do
  sh('rm', '-rf', 'build')
end

task :deploy => [:clean, :build] do
  sh('bundle', 'exec', 'middleman', 'deploy')
end

# basic setup
def deps
  sh('bundle', 'install')
  sh('npm', 'install', 'bower')
  sh('bower', 'install')
end

def git_config(username)
  sh('git', 'config', 'user.email', 'torsneyt@gmail.com')
  sh('git', 'config', 'user.name', username)
  #sh('git', 'config', '--global', 'user.email', 'torsneyt@gmail.com')
  #sh('git', 'config', '--global', 'user.name', username)
  sh('git', 'remote', 'add', 'gh-pages', 'git@github.com:gabysbrain/gabysbrain.github.io.git')
end

